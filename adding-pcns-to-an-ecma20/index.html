<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Adding PCNS to an ECMA2.0 - Identity Technology (again)</title><meta name="description" content="One of my favourite tools that comes with working at Oxford Computer Group is an ECMA2 called the “delta generator”&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://github.com/identity-jason/identech/adding-pcns-to-an-ecma20/"><link rel="alternate" type="application/atom+xml" href="https://github.com/identity-jason/identech/feed.xml"><link rel="alternate" type="application/json" href="https://github.com/identity-jason/identech/feed.json"><meta property="og:title" content="Adding PCNS to an ECMA2.0"><meta property="og:site_name" content="Identity Technology (again)"><meta property="og:description" content="One of my favourite tools that comes with working at Oxford Computer Group is an ECMA2 called the “delta generator”&hellip;"><meta property="og:url" content="https://github.com/identity-jason/identech/adding-pcns-to-an-ecma20/"><meta property="og:type" content="article"><style>:root{--primary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--secondary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/style.css?v=dd2f5302461b6031e60971f8134aab44"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/identity-jason/identech/adding-pcns-to-an-ecma20/"},"headline":"Adding PCNS to an ECMA2.0","datePublished":"2014-05-16T03:08","dateModified":"2022-01-09T11:32","description":"One of my favourite tools that comes with working at Oxford Computer Group is an ECMA2 called the “delta generator”&hellip;","author":{"@type":"Person","name":"identity_jason"},"publisher":{"@type":"Organization","name":"identity_jason"}}</script></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://github.com/identity-jason/identech/"><strong>Identity Technology (again)</strong></a></header><article class="post"><header class="main post__header"><time datetime="2014-05-16T03:08" class="post__date">May 16, 2014</time><h1>Adding PCNS to an ECMA2.0</h1></header><div class="post__inner post__entry"><p align="justify">One of my favourite tools that comes with working at Oxford Computer Group is an ECMA2 called the “delta generator” – at it’s simplest it’s a faster version of the FIM SQL management agent, but it’s got a few extra tricks up its sleeve that make it an common tool to reach for whenever I’m working on a project.</p><p align="justify">This time, I’ve been asked to add a password hash to an existing SQL database and to treat the connector as a PCNS target.</p><p align="justify">Initially I thought it wouldn’t be a problem until I got into FIM to configure myself a Password extension and was faced with the Extensions page of the MA Properties:</p><p align="justify"><a href="http://identitytechnology.net/wp-content/uploads/2014/05/image.png"><img loading="lazy" title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://github.com/identity-jason/identech/media/posts/35/image_thumb.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb-xs.png 300w, https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb-sm.png 480w, https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb-md.png 768w" width="477" height="353"></a></p><p align="justify">As you can see, I’ve checked the ‘Enable Password Management’ box however this has defaulted to the delta generator DLL rather than allowing me to insert my own code.</p><p align="justify">Usually this wouldn’t be a problem – most of the time I’ve either built the ECMA2 myself or its source is part of the project, however this is one of our stock tools and creating a custom version would cause no end of downstream issues – especially as this tool sometimes crops up several times on the same FIM configuration and I really don’t want to have a password extension for one part of the project cropping up on management agents for other systems – or the overhead of trying to manage any future updates to delta generator back into the new connector.</p><p align="justify">In order to work around this, I built myself a brand new ECMA2 and added a reference to the original delta generator – the interfaces call for public methods and no parameters on the constructor so in theory it should be fairly simple to create my own instance of the delta generator within my ECMA and pass parameters back and forth between FIM and the underlying code as follows:</p><pre class="csharpcode"><span class="kwrd">using</span> System;<restore-line-break><span class="kwrd">using</span> System.IO;<restore-line-break><span class="kwrd">using</span> System.Xml;<restore-line-break><span class="kwrd">using</span> System.Text;<restore-line-break><span class="kwrd">using</span> System.Collections.Specialized;<restore-line-break><span class="kwrd">using</span> Microsoft.MetadirectoryServices;<restore-line-break><restore-line-break><span class="kwrd">using</span> OxfordComputerGroup;  <span class="rem">//-- I added this in to get the existing ECMA2 </span><restore-line-break><restore-line-break><span class="kwrd">namespace</span> FimSync_Ezma<restore-line-break>{<restore-line-break>    <span class="kwrd">public</span> <span class="kwrd">class</span> EzmaExtension <span class="rem">//:</span><restore-line-break>    <span class="rem">//IMAExtensible2CallExport,</span><restore-line-break>    <span class="rem">//IMAExtensible2CallImport,</span><restore-line-break>    <span class="rem">//IMAExtensible2FileImport,</span><restore-line-break>    <span class="rem">//IMAExtensible2FileExport,</span><restore-line-break>    <span class="rem">//IMAExtensible2GetHierarchy,</span><restore-line-break>    <span class="rem">//IMAExtensible2GetSchema,</span><restore-line-break>    <span class="rem">//IMAExtensible2GetCapabilities,</span><restore-line-break>    <span class="rem">//IMAExtensible2GetParameters,</span><restore-line-break>    <span class="rem">//IMAExtensible2GetPartitions</span><restore-line-break>    {<restore-line-break>        OxfordComputerGroup.OxfordDeltaImport _delta_gen = <span class="kwrd">null</span>;<restore-line-break><restore-line-break>        <span class="rem">//</span><restore-line-break>        <span class="rem">// Constructor</span><restore-line-break>        <span class="rem">//</span><restore-line-break>        <span class="kwrd">public</span> EzmaExtension()<restore-line-break>        {<restore-line-break>            _delta_gen = <span class="kwrd">new</span> OxfordDeltaImport();<restore-line-break>        }<restore-line-break>    };<restore-line-break>}<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p></p><style type="text/css">.csharpcode, .csharpcode pre<restore-line-break>{<restore-line-break>	font-size: small;<restore-line-break>	color: black;<restore-line-break>	font-family: consolas, "Courier New", courier, monospace;<restore-line-break>	background-color: #ffffff;<restore-line-break>	/*white-space: pre;*/<restore-line-break>}<restore-line-break>.csharpcode pre { margin: 0em; }<restore-line-break>.csharpcode .rem { color: #008000; }<restore-line-break>.csharpcode .kwrd { color: #0000ff; }<restore-line-break>.csharpcode .str { color: #006080; }<restore-line-break>.csharpcode .op { color: #0000c0; }<restore-line-break>.csharpcode .preproc { color: #cc6633; }<restore-line-break>.csharpcode .asp { background-color: #ffff00; }<restore-line-break>.csharpcode .html { color: #800000; }<restore-line-break>.csharpcode .attr { color: #ff0000; }<restore-line-break>.csharpcode .alt <restore-line-break>{<restore-line-break>	background-color: #f4f4f4;<restore-line-break>	width: 100%;<restore-line-break>	margin: 0em;<restore-line-break>}<restore-line-break>.csharpcode .lnum { color: #606060; }<restore-line-break></style><p></p><p align="justify">From here, I added the core interfaces one at a time, passing in any parameters and returning any values from the delta generator back out to FIM – for example, the CallExport interface is implemented as follows:</p><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">void</span> CloseExportConnection(CloseExportConnectionRunStep exportRunStep)<restore-line-break>{<restore-line-break>    _delta_gen.CloseExportConnection(exportRunStep);<restore-line-break>}<restore-line-break><restore-line-break><span class="kwrd">public</span> <span class="kwrd">int</span> ExportDefaultPageSize<restore-line-break>{<restore-line-break>    get { <span class="kwrd">return</span> _delta_gen.ExportDefaultPageSize; }<restore-line-break>}<restore-line-break><restore-line-break><span class="kwrd">public</span> <span class="kwrd">int</span> ExportMaxPageSize<restore-line-break>{<restore-line-break>    get { <span class="kwrd">return</span> _delta_gen.ExportMaxPageSize; }<restore-line-break>}<restore-line-break><restore-line-break><span class="kwrd">public</span> <span class="kwrd">void</span> OpenExportConnection(System.Collections.ObjectModel.KeyedCollection&lt;<span class="kwrd">string</span>, ConfigParameter&gt; configParameters, Schema types, OpenExportConnectionRunStep exportRunStep)<restore-line-break>{<restore-line-break>    _delta_gen.OpenExportConnection(configParameters, types, exportRunStep);<restore-line-break>}<restore-line-break><restore-line-break><span class="kwrd">public</span> PutExportEntriesResults PutExportEntries(System.Collections.Generic.IList&lt;CSEntryChange&gt; csentries)<restore-line-break>{<restore-line-break>    <span class="kwrd">return</span> _delta_gen.PutExportEntries(csentries);<restore-line-break>}</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p></p><style type="text/css">.csharpcode, .csharpcode pre<restore-line-break>{<restore-line-break>	font-size: small;<restore-line-break>	color: black;<restore-line-break>	font-family: consolas, "Courier New", courier, monospace;<restore-line-break>	background-color: #ffffff;<restore-line-break>	/*white-space: pre;*/<restore-line-break>}<restore-line-break>.csharpcode pre { margin: 0em; }<restore-line-break>.csharpcode .rem { color: #008000; }<restore-line-break>.csharpcode .kwrd { color: #0000ff; }<restore-line-break>.csharpcode .str { color: #006080; }<restore-line-break>.csharpcode .op { color: #0000c0; }<restore-line-break>.csharpcode .preproc { color: #cc6633; }<restore-line-break>.csharpcode .asp { background-color: #ffff00; }<restore-line-break>.csharpcode .html { color: #800000; }<restore-line-break>.csharpcode .attr { color: #ff0000; }<restore-line-break>.csharpcode .alt <restore-line-break>{<restore-line-break>	background-color: #f4f4f4;<restore-line-break>	width: 100%;<restore-line-break>	margin: 0em;<restore-line-break>}<restore-line-break>.csharpcode .lnum { color: #606060; }<restore-line-break></style><p></p><p align="justify">Working back from the interfaces exposed from the original Management Agent, it should be relatively simple to stand up matching interfaces on the Wrapper MA and fill in the blanks in the same manner as above – passing the values back and forth between the FIM and the core DLL.</p><p align="justify">Once this was working (and tested) I added the IMAExtensible2Password interface (this one isn’t automatically provided by the template generator for some reason) and started to implement the new Password Extension methods.</p><p align="justify">While these are a major improvement over the original Password Extension as you can access the same set of configuration parameters used by the hosting Management Agent, it quickly became obvious that I was missing a key detail that was unique to the Password Extension – the name of the certificate to use for encryption and signing.</p><p align="justify">Fortunately as well as wrapping up the existing DLL, because the Parameters are passed back from the original delta generator via our wrapper, it is possible to inject additional items – as far as FIM is concerned, it is still retrieving a legitimate collection of parameters to query the user for.</p><p></p><style type="text/css">.csharpcode, .csharpcode pre<restore-line-break>{<restore-line-break>	font-size: small;<restore-line-break>	color: black;<restore-line-break>	font-family: consolas, "Courier New", courier, monospace;<restore-line-break>	background-color: #ffffff;<restore-line-break>	/*white-space: pre;*/<restore-line-break>}<restore-line-break>.csharpcode pre { margin: 0em; }<restore-line-break>.csharpcode .rem { color: #008000; }<restore-line-break>.csharpcode .kwrd { color: #0000ff; }<restore-line-break>.csharpcode .str { color: #006080; }<restore-line-break>.csharpcode .op { color: #0000c0; }<restore-line-break>.csharpcode .preproc { color: #cc6633; }<restore-line-break>.csharpcode .asp { background-color: #ffff00; }<restore-line-break>.csharpcode .html { color: #800000; }<restore-line-break>.csharpcode .attr { color: #ff0000; }<restore-line-break>.csharpcode .alt <restore-line-break>{<restore-line-break>	background-color: #f4f4f4;<restore-line-break>	width: 100%;<restore-line-break>	margin: 0em;<restore-line-break>}<restore-line-break>.csharpcode .lnum { color: #606060; }<restore-line-break></style><p></p><pre class="csharpcode"><restore-line-break><span class="kwrd">public</span> System.Collections.Generic.IList&lt;ConfigParameterDefinition&gt; GetConfigParameters(System.Collections.ObjectModel.KeyedCollection&lt;<span class="kwrd">string</span>, ConfigParameter&gt; configParameters, ConfigParameterPage page)<restore-line-break>{<restore-line-break>    System.Collections.Generic.IList&lt;ConfigParameterDefinition&gt; details = _delta_gen.GetConfigParameters(configParameters, page);<restore-line-break>    <span class="kwrd">if</span> (page == ConfigParameterPage.Connectivity)<restore-line-break>    {<restore-line-break>        details.Add(ConfigParameterDefinition.CreateStringParameter(<span class="str">"Certificate"</span>, <span class="str">""</span>));<restore-line-break>    }<restore-line-break><restore-line-break>    <span class="kwrd">return</span> details;<restore-line-break>}</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p></p><style type="text/css">.csharpcode, .csharpcode pre<restore-line-break>{<restore-line-break>	font-size: small;<restore-line-break>	color: black;<restore-line-break>	font-family: consolas, "Courier New", courier, monospace;<restore-line-break>	background-color: #ffffff;<restore-line-break>	/*white-space: pre;*/<restore-line-break>}<restore-line-break>.csharpcode pre { margin: 0em; }<restore-line-break>.csharpcode .rem { color: #008000; }<restore-line-break>.csharpcode .kwrd { color: #0000ff; }<restore-line-break>.csharpcode .str { color: #006080; }<restore-line-break>.csharpcode .op { color: #0000c0; }<restore-line-break>.csharpcode .preproc { color: #cc6633; }<restore-line-break>.csharpcode .asp { background-color: #ffff00; }<restore-line-break>.csharpcode .html { color: #800000; }<restore-line-break>.csharpcode .attr { color: #ff0000; }<restore-line-break>.csharpcode .alt <restore-line-break>{<restore-line-break>	background-color: #f4f4f4;<restore-line-break>	width: 100%;<restore-line-break>	margin: 0em;<restore-line-break>}<restore-line-break>.csharpcode .lnum { color: #606060; }<restore-line-break></style><p></p><p>Once compiled and built, this wrapper can now be dropped into place within the Management Agent in place of the delta generator and refreshing it’s interfaces brings the new Password capabilities into play:</p><p><a href="http://identitytechnology.net/wp-content/uploads/2014/05/image1.png"><img loading="lazy" title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://github.com/identity-jason/identech/media/posts/35/image_thumb1.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb1-xs.png 300w, https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb1-sm.png 480w, https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb1-md.png 768w" width="529" height="391"></a></p><p>This time, visiting the Configure Extensions page and enabling password management still refers back to the ECMA2 DLL however this time, the correct Password Extension is in place to be able to perform the required updates:</p><p><a href="http://identitytechnology.net/wp-content/uploads/2014/05/image2.png"><img loading="lazy" title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://github.com/identity-jason/identech/media/posts/35/image_thumb2.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb2-xs.png 300w, https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb2-sm.png 480w, https://github.com/identity-jason/identech/media/posts/35/responsive/image_thumb2-md.png 768w" width="530" height="392"></a></p></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on January 9, 2022</p><div class="post__share"><h3>Share post:</h3></div><div class="post__bio"><div><h3><a href="https://github.com/identity-jason/identech/authors/identity_jason/" class="invert" rel="author">identity_jason</a></h3></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><nav id="menu"><header class="major"><h2>Menu</h2></header></nav><section><header class="major"><h2>Get in touch</h2></header><p>Sed varius enim lorem ullamcorper dolore aliquam aenean ornare velit lacus,ac varius enim lorem ullamcorper dolore. Proin sed aliqu facilisis ante interdum. Sed nulla amet lorem feugiat tempus aliquam.</p><ul class="contact"><li class="icon solid fa-envelope"><a href="#">information@untitled.tld</a></li><li class="icon solid fa-phone">(000) 000-0000</li><li class="icon solid fa-home">1234 Somewhere Road #8254<br>Nashville, TN 00000-0000</li></ul></section><footer id="footer"><p class="copyright">&copy; Editorial 2 - All rights reserved<br>Design by: <a href="https://html5up.net" target="_blank" rel="noopener">HTML5 UP</a>, Powered by Publii</p></footer></div></div></div><script src="https://github.com/identity-jason/identech/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://github.com/identity-jason/identech/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://github.com/identity-jason/identech/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://github.com/identity-jason/identech/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://github.com/identity-jason/identech/assets/js/main.min.js?v=448f4c9d4b4c374766a1cb76c3d88048"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script></body></html>