<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Proxy This! - Identity Technology (again)</title><meta name="description" content="As ever, I’m in a new environment with a new set of firewall and proxy restrictions and seeing as I’m&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://github.com/identity-jason/identech/proxy-this/"><link rel="alternate" type="application/atom+xml" href="https://github.com/identity-jason/identech/feed.xml"><link rel="alternate" type="application/json" href="https://github.com/identity-jason/identech/feed.json"><meta property="og:title" content="Proxy This!"><meta property="og:site_name" content="Identity Technology (again)"><meta property="og:description" content="As ever, I’m in a new environment with a new set of firewall and proxy restrictions and seeing as I’m&hellip;"><meta property="og:url" content="https://github.com/identity-jason/identech/proxy-this/"><meta property="og:type" content="article"><style>:root{--primary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--secondary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/style.css?v=dd2f5302461b6031e60971f8134aab44"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/identity-jason/identech/proxy-this/"},"headline":"Proxy This!","datePublished":"2011-08-16T11:55","dateModified":"2022-01-09T11:32","description":"As ever, I’m in a new environment with a new set of firewall and proxy restrictions and seeing as I’m&hellip;","author":{"@type":"Person","name":"identity_jason"},"publisher":{"@type":"Organization","name":"identity_jason"}}</script></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://github.com/identity-jason/identech/"><strong>Identity Technology (again)</strong></a></header><article class="post"><header class="main post__header"><time datetime="2011-08-16T11:55" class="post__date">August 16, 2011</time><h1>Proxy This!</h1></header><div class="post__inner post__entry"><p>As ever, I’m in a new environment with a new set of firewall and proxy restrictions and seeing as I’m working on an Office365 deployment, powershell is pretty much an essential piece of the puzzle.</p><p>From my laptop, I’ve got “direct” access to the internet (or at least the proxy isn’t too terrible) and I can launch powershell and connect it up to Office365 without any problems – always a good start!</p><p>From the server I’m working on to automate a number of tasks, I can launch powershell but can’t connect to Office365 due to a credential problem.</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/08/image.png"><img loading="lazy" style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="https://github.com/identity-jason/identech/media/posts/3/image_thumb.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/3/responsive/image_thumb-xs.png 300w, https://github.com/identity-jason/identech/media/posts/3/responsive/image_thumb-sm.png 480w, https://github.com/identity-jason/identech/media/posts/3/responsive/image_thumb-md.png 768w" width="633" height="114"></a></p><p><pre class="csharpcode">Connect-MsolService : Unable to authenticate your credentials. Make <br>sure that your user name is <span class="kwrd">in</span> the format: &lt;username&gt;@&lt;domain&gt;. <br>If this problem persists, contact Support.<restore-line-break>At line:1 char:20<restore-line-break>+ Connect-MsolService &lt;&lt;&lt;&lt;<restore-line-break>    + CategoryInfo          : OperationStopped: (:) [Connect-MsolService], MicrosoftOnlineException<restore-line-break>    + FullyQualifiedErrorId : 0x80048862,Microsoft.Online.Administration.Automation.ConnectMsolService</restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></p><p>After some investigation, it seems that I need to set up the proxy using netsh as well as in the browser – at which point this works.</p><p>After I’ve been working for a while, I start attempting to execute some code under the service account context that’ll be running with this permanently and get an entirely different set of errors – my account is fine, service account – not so good.</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/08/image1.png"><img loading="lazy" style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="https://github.com/identity-jason/identech/media/posts/3/image_thumb1.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/3/responsive/image_thumb1-xs.png 300w, https://github.com/identity-jason/identech/media/posts/3/responsive/image_thumb1-sm.png 480w, https://github.com/identity-jason/identech/media/posts/3/responsive/image_thumb1-md.png 768w" width="633" height="167"></a></p><p>This time – I can authenticate successfully (trying a non-existent login reports that the username doesn’t exist) but can’t finalize the connection.</p><pre class="csharpcode">Connect-MsolService : Could not connect to ps://provisioningapi.microsoftonline.com/provisioningwebservice.svc. TCP error code 10060: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond 213.199.182.205:443.<restore-line-break>At line:1 char:20<restore-line-break>+ Connect-MsolService &lt;&lt;&lt;&lt;<restore-line-break>    + CategoryInfo          : OperationStopped: (:) [Connect-MsolService], EndpointNotFoundException<restore-line-break>    + FullyQualifiedErrorId : System.ServiceModel.EndpointNotFoundException,Microsoft.Online.Administration.Automation.ConnectMsolService<restore-line-break><restore-line-break>Connect-MsolService : Exception of type <span class="str">'Microsoft.Online.Administration.Automation.MicrosoftOnlineException'</span> was thrown.<restore-line-break>At line:1 char:20<restore-line-break>+ Connect-MsolService &lt;&lt;&lt;&lt;<restore-line-break>    + CategoryInfo          : OperationStopped: (:) [Connect-MsolService], MicrosoftOnlineException<restore-line-break>    + FullyQualifiedErrorId : Microsoft.Online.Administration.Automation.MicrosoftOnlineException,Microsoft.Online.Administration.Automation.ConnectMsolService</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>After much frustration – turns out that while I’ve set the proxy using netsh, I haven’t gone back and set the proxy in the browser’s connection settings so I’m getting blocked there instead all the while feeling overly smug for remembering to check “the complicated” proxy setting.</p><p>One quick addition of the proxy via Internet explorer (under the user session for the service account) and a successful connection to Office365 later, we’re on with the reset of testing.</p><style type="text/css">.csharpcode, .csharpcode pre<restore-line-break>{<restore-line-break>	font-size: small;<restore-line-break>	color: black;<restore-line-break>	font-family: consolas, "Courier New", courier, monospace;<restore-line-break>	background-color: #ffffff;<restore-line-break>	/*white-space: pre;*/<restore-line-break>}<restore-line-break>.csharpcode pre { margin: 0em; }<restore-line-break>.csharpcode .rem { color: #008000; }<restore-line-break>.csharpcode .kwrd { color: #0000ff; }<restore-line-break>.csharpcode .str { color: #006080; }<restore-line-break>.csharpcode .op { color: #0000c0; }<restore-line-break>.csharpcode .preproc { color: #cc6633; }<restore-line-break>.csharpcode .asp { background-color: #ffff00; }<restore-line-break>.csharpcode .html { color: #800000; }<restore-line-break>.csharpcode .attr { color: #ff0000; }<restore-line-break>.csharpcode .alt <restore-line-break>{<restore-line-break>	background-color: #f4f4f4;<restore-line-break>	width: 100%;<restore-line-break>	margin: 0em;<restore-line-break>}<restore-line-break>.csharpcode .lnum { color: #606060; }<restore-line-break></style><p></p></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on January 9, 2022</p><div class="post__share"><h3>Share post:</h3></div><div class="post__bio"><div><h3><a href="https://github.com/identity-jason/identech/authors/identity_jason/" class="invert" rel="author">identity_jason</a></h3></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><nav id="menu"><header class="major"><h2>Menu</h2></header></nav><section><header class="major"><h2>Get in touch</h2></header><p>Sed varius enim lorem ullamcorper dolore aliquam aenean ornare velit lacus,ac varius enim lorem ullamcorper dolore. Proin sed aliqu facilisis ante interdum. Sed nulla amet lorem feugiat tempus aliquam.</p><ul class="contact"><li class="icon solid fa-envelope"><a href="#">information@untitled.tld</a></li><li class="icon solid fa-phone">(000) 000-0000</li><li class="icon solid fa-home">1234 Somewhere Road #8254<br>Nashville, TN 00000-0000</li></ul></section><footer id="footer"><p class="copyright">&copy; Editorial 2 - All rights reserved<br>Design by: <a href="https://html5up.net" target="_blank" rel="noopener">HTML5 UP</a>, Powered by Publii</p></footer></div></div></div><script src="https://github.com/identity-jason/identech/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://github.com/identity-jason/identech/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://github.com/identity-jason/identech/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://github.com/identity-jason/identech/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://github.com/identity-jason/identech/assets/js/main.min.js?v=448f4c9d4b4c374766a1cb76c3d88048"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script></body></html>