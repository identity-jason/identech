<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Revisit&amp;ndash;Export from FIM Portal to AVP - Identity Technology (again)</title><meta name="description" content="I’ve been making extensive use of my DumpAVP.ps1 script – it’s one of those things that (at least for me)&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://github.com/identity-jason/identech/revisitandndashexport-from-fim-portal-to-avp/"><link rel="alternate" type="application/atom+xml" href="https://github.com/identity-jason/identech/feed.xml"><link rel="alternate" type="application/json" href="https://github.com/identity-jason/identech/feed.json"><meta property="og:title" content="Revisit&ndash;Export from FIM Portal to AVP"><meta property="og:site_name" content="Identity Technology (again)"><meta property="og:description" content="I’ve been making extensive use of my DumpAVP.ps1 script – it’s one of those things that (at least for me)&hellip;"><meta property="og:url" content="https://github.com/identity-jason/identech/revisitandndashexport-from-fim-portal-to-avp/"><meta property="og:type" content="article"><style>:root{--primary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--secondary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/style.css?v=dd2f5302461b6031e60971f8134aab44"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/identity-jason/identech/revisitandndashexport-from-fim-portal-to-avp/"},"headline":"Revisit&ndash;Export from FIM Portal to AVP","datePublished":"2011-12-15T20:18","dateModified":"2022-01-09T11:32","description":"I’ve been making extensive use of my DumpAVP.ps1 script – it’s one of those things that (at least for me)&hellip;","author":{"@type":"Person","name":"identity_jason"},"publisher":{"@type":"Organization","name":"identity_jason"}}</script></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://github.com/identity-jason/identech/"><strong>Identity Technology (again)</strong></a></header><article class="post"><header class="main post__header"><time datetime="2011-12-15T20:18" class="post__date">December 15, 2011</time><h1>Revisit&amp;ndash;Export from FIM Portal to AVP</h1></header><div class="post__inner post__entry"><p>I’ve been making extensive use of my DumpAVP.ps1 script – it’s one of those things that (at least for me) has been so useful I can’t believe I didn’t drop it together sooner.</p><p>As part of increased usage, I’ve noticed that sometimes the original was a little flawed as any reference attributes brought back the object GUID being referred to rather than the display name so I’ve made some additional changes so that when a named attribute is brought back, then (assuming it’s a reference – that’ll be the next version!) go looking for the object being referred to and retrieve a specified attribute.</p><p>Usage is simple – DumpAVP.PS1 &lt;xpath&gt;</p><p>“If” you need to extend it by adding additional references to follow, drop in a “Name”=&gt;”Attribute” pair into the references collection, with the Name being the name in the source object and the Attribute being the name of the attribute to retrieve and display within the AVP output.</p><pre class="csharpcode">#-----------------------------------------------------------------------------<restore-line-break>#--<restore-line-break>#--    DumpAVP.PS1<restore-line-break>#-- Jason Banks - jasonb@identitytechnology.net<restore-line-break>#--<restore-line-break>#-- Extracts data from the FIM portal and exports (to console) <span class="kwrd">in</span> AVP format<restore-line-break>#--<restore-line-break>#-----------------------------------------------------------------------------<restore-line-break><restore-line-break>Param ($filter, $uri)<restore-line-break><restore-line-break>$references = @{<span class="str">"Manager"</span> = <span class="str">"AccountName"</span>; <span class="str">"Creator"</span> = <span class="str">"DisplayName"</span>; <span class="str">"DomainConfiguration"</span> = <span class="str">"DisplayName"</span>; <span class="str">"Target"</span> = <span class="str">"DisplayName"</span>;}<restore-line-break>$cache = @{}<restore-line-break><restore-line-break><span class="kwrd">if</span> (@(get-pssnapin | <span class="kwrd">where</span>-<span class="kwrd">object</span> {$_.Name -eq <span class="str">"FIMAutomation"</span>} ).count -eq 0)<restore-line-break>{<restore-line-break>    Add-PSSnapIn FIMAutomation<restore-line-break>}<restore-line-break><restore-line-break><span class="kwrd">if</span> ($uri -eq $<span class="kwrd">null</span>)<restore-line-break>{<restore-line-break>    $uri = <span class="str">"http://localhost:5725/ResourceManagementService"</span><restore-line-break>}<restore-line-break><restore-line-break>$results = export-fimconfig -uri $uri -CustomConfig $filter -OnlyBaseResources<restore-line-break><restore-line-break><span class="kwrd">foreach</span> ($item <span class="kwrd">in</span> $results)<restore-line-break>{        <restore-line-break>    <span class="kwrd">foreach</span> ($attr <span class="kwrd">in</span> $item.ResourceManagementObject.ResourceManagementAttributes)<restore-line-break>    {<restore-line-break>        $attr_name = $attr.AttributeName            <restore-line-break>        <restore-line-break>        <span class="kwrd">if</span> ($references.ContainsKey($attr_name))<restore-line-break>        {<restore-line-break>            $attr_check = $references.Get_Item($attr_name)<restore-line-break>            $objectid = $attr.Value<restore-line-break>            $objectid = $objectid.Replace(<span class="str">"urn:uuid:"</span>,<span class="str">""</span>)<restore-line-break>            <restore-line-break>            $lookup = $<span class="kwrd">null</span><restore-line-break>            <restore-line-break>            <span class="kwrd">if</span> ($cache.ContainsKey($objectid))<restore-line-break>            {                <restore-line-break>                $lookup = $cache.Get_Item($objectid)<restore-line-break>                        <restore-line-break>            }<restore-line-break>            <span class="kwrd">else</span><restore-line-break>            {            <restore-line-break>                #-- note - expects results to be single valued...<restore-line-break>                $lookup = export-fimconfig -uri $uri -OnlyBaseResources -CustomConfig <span class="str">"/*[ObjectID='$objectid']"</span><restore-line-break>                $cache.Add($objectid, $lookup)<restore-line-break>            }<restore-line-break>            <restore-line-break>            <span class="kwrd">foreach</span> ($l <span class="kwrd">in</span> $lookup)<restore-line-break>            {<restore-line-break>                <span class="kwrd">foreach</span> ($lu <span class="kwrd">in</span> $l.ResourceManagementObject.ResourceManagementAttributes)<restore-line-break>                {<restore-line-break>                    <span class="kwrd">if</span> ($lu.AttributeName -eq $attr_check)<restore-line-break>                    {<restore-line-break>                        $line = $attr.AttributeName + <span class="str">": "</span> + $lu.Value<restore-line-break>                        Write-Output $line<restore-line-break>                    }<restore-line-break>                }<restore-line-break>            }<restore-line-break>        }<restore-line-break>        <span class="kwrd">else</span><restore-line-break>        {    <restore-line-break>            $line = $attr.AttributeName + <span class="str">": "</span> + $attr.Value<restore-line-break>            Write-Output $line<restore-line-break>        }<restore-line-break>    }<restore-line-break>    Write-Output <span class="str">""</span><restore-line-break>    Write-Output <span class="str">""</span><restore-line-break>}<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p></p><style type="text/css">.csharpcode, .csharpcode pre<restore-line-break>{<restore-line-break>	font-size: small;<restore-line-break>	color: black;<restore-line-break>	font-family: consolas, "Courier New", courier, monospace;<restore-line-break>	background-color: #ffffff;<restore-line-break>	/*white-space: pre;*/<restore-line-break>}<restore-line-break>.csharpcode pre { margin: 0em; }<restore-line-break>.csharpcode .rem { color: #008000; }<restore-line-break>.csharpcode .kwrd { color: #0000ff; }<restore-line-break>.csharpcode .str { color: #006080; }<restore-line-break>.csharpcode .op { color: #0000c0; }<restore-line-break>.csharpcode .preproc { color: #cc6633; }<restore-line-break>.csharpcode .asp { background-color: #ffff00; }<restore-line-break>.csharpcode .html { color: #800000; }<restore-line-break>.csharpcode .attr { color: #ff0000; }<restore-line-break>.csharpcode .alt <restore-line-break>{<restore-line-break>	background-color: #f4f4f4;<restore-line-break>	width: 100%;<restore-line-break>	margin: 0em;<restore-line-break>}<restore-line-break>.csharpcode .lnum { color: #606060; }<restore-line-break></style><p></p></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on January 9, 2022</p><div class="post__share"><h3>Share post:</h3></div><div class="post__bio"><div><h3><a href="https://github.com/identity-jason/identech/authors/identity_jason/" class="invert" rel="author">identity_jason</a></h3></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><nav id="menu"><header class="major"><h2>Menu</h2></header></nav><section><header class="major"><h2>Get in touch</h2></header><p>Sed varius enim lorem ullamcorper dolore aliquam aenean ornare velit lacus,ac varius enim lorem ullamcorper dolore. Proin sed aliqu facilisis ante interdum. Sed nulla amet lorem feugiat tempus aliquam.</p><ul class="contact"><li class="icon solid fa-envelope"><a href="#">information@untitled.tld</a></li><li class="icon solid fa-phone">(000) 000-0000</li><li class="icon solid fa-home">1234 Somewhere Road #8254<br>Nashville, TN 00000-0000</li></ul></section><footer id="footer"><p class="copyright">&copy; Editorial 2 - All rights reserved<br>Design by: <a href="https://html5up.net" target="_blank" rel="noopener">HTML5 UP</a>, Powered by Publii</p></footer></div></div></div><script src="https://github.com/identity-jason/identech/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://github.com/identity-jason/identech/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://github.com/identity-jason/identech/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://github.com/identity-jason/identech/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://github.com/identity-jason/identech/assets/js/main.min.js?v=448f4c9d4b4c374766a1cb76c3d88048"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script></body></html>