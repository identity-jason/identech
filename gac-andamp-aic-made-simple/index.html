<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>GAC &amp;amp; AIC made simple - Identity Technology (again)</title><meta name="description" content="One of the projects I’m currently working on has an awful lot of custom workflow activities, and that means that&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://github.com/identity-jason/identech/gac-andamp-aic-made-simple/"><link rel="alternate" type="application/atom+xml" href="https://github.com/identity-jason/identech/feed.xml"><link rel="alternate" type="application/json" href="https://github.com/identity-jason/identech/feed.json"><meta property="og:title" content="GAC &amp; AIC made simple"><meta property="og:site_name" content="Identity Technology (again)"><meta property="og:description" content="One of the projects I’m currently working on has an awful lot of custom workflow activities, and that means that&hellip;"><meta property="og:url" content="https://github.com/identity-jason/identech/gac-andamp-aic-made-simple/"><meta property="og:type" content="article"><style>:root{--primary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--secondary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/style.css?v=dd2f5302461b6031e60971f8134aab44"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/identity-jason/identech/gac-andamp-aic-made-simple/"},"headline":"GAC &amp; AIC made simple","datePublished":"2012-02-18T00:13","dateModified":"2022-01-09T11:32","description":"One of the projects I’m currently working on has an awful lot of custom workflow activities, and that means that&hellip;","author":{"@type":"Person","name":"identity_jason"},"publisher":{"@type":"Organization","name":"identity_jason"}}</script></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://github.com/identity-jason/identech/"><strong>Identity Technology (again)</strong></a></header><article class="post"><header class="main post__header"><time datetime="2012-02-18T00:13" class="post__date">February 18, 2012</time><h1>GAC &amp;amp; AIC made simple</h1></header><div class="post__inner post__entry"><p>One of the projects I’m currently working on has an awful lot of custom workflow activities, and that means that I spend a lot of time adding things to the global assembly cache and creating AIC entries – so much time, that I’ve invested a little of it in a powershell script that takes a DLL and – providing it meets certain entry conditions (or is at least strongly signed!) adds it to the GAC and then creates a matching AIC entry for it.</p><p>There is a version online at the <a title="FIM Scriptbox" href="http://social.technet.microsoft.com/wiki/contents/articles/7572.how-to-use-powershell-to-add-workflowactivities-to-gac-and-aic.aspx" target="_blank">FIM Scriptbox</a> as well.</p><p><em>Usage is installAIC.ps1 &lt;full path to dll&gt;</em></p><p><em>One thing that I hadn't done previously, was making use of Powershell to add items into the GAC and to obtain the publicly available details of a dll - the article <a title="Here" href="http://codeimpossible.com/2010/7/21/Installing-Assemblies-to-GAC-with-PowerShell" target="_blank">here </a>was most useful!</em></p><p>[wpfilebase tag=file path='Powershell/installaic.ps1' /]</p><pre class="csharpcode">#-- InstallAIC.PS1<restore-line-break>#--<restore-line-break>#-- Registers a DLL into the GAC and installs it into the AIC (providing it has the WorkflowPart and UIpart elements)<restore-line-break><restore-line-break>#-- Usage: installaic.ps1 &lt;full path to dll&gt;<restore-line-break>#-- e.g.   installaic.ps1 <span class="str">"c:\program files\microsoft forefront identity manager\2010\service\ocg.MyWorkflow.dll"</span><restore-line-break><restore-line-break>#-- GAC elements adapted from http:<span class="rem">//codeimpossible.com/2010/7/21/Installing-Assemblies-to-GAC-with-PowerShell</span><restore-line-break><restore-line-break>Param ($dllpath)<restore-line-break><restore-line-break>#--------------------------------------------------------------------------------------------------------------------<restore-line-break>#--<restore-line-break>Function AddChangeToResource<restore-line-break>{<restore-line-break>    Param($Resource, $AttributeName, $AttributeValue, $Operation)<restore-line-break><restore-line-break>    $ImportChange = New-Object Microsoft.ResourceManagement.Automation.ObjectModel.ImportChange<restore-line-break>    $ImportChange.Operation = $Operation<restore-line-break>    $ImportChange.AttributeName = $AttributeName<restore-line-break>    $ImportChange.AttributeValue = $AttributeValue<restore-line-break>    $ImportChange.FullyResolved = 1<restore-line-break>    $ImportChange.Locale = <span class="str">"Invariant"</span><restore-line-break><restore-line-break>    If($Resource.Changes -eq $<span class="kwrd">null</span>)<restore-line-break>        {$Resource.Changes = (,$ImportChange)}<restore-line-break>    Else<restore-line-break>        {$Resource.Changes += $ImportChange}<restore-line-break><restore-line-break>}<restore-line-break>#--------------------------------------------------------------------------------------------------------------------<restore-line-break><restore-line-break>#--------------------------------------------------------------------------------------------------------------------<restore-line-break>#--<restore-line-break>function SubmitResource<restore-line-break>{<restore-line-break>   Param($Resource)<restore-line-break><restore-line-break>   $Resource | Import-FIMConfig -ErrorVariable Err `<restore-line-break>                                -ErrorAction SilentlyContinue<restore-line-break>   If($Err){Throw $Err}<restore-line-break><restore-line-break>}<restore-line-break>#--------------------------------------------------------------------------------------------------------------------<restore-line-break><restore-line-break>#--------------------------------------------------------------------------------------------------------------------<restore-line-break>#--<restore-line-break>Function CreateResource<restore-line-break>{<restore-line-break>    Param($ObjectType, $DisplayName)    <restore-line-break><restore-line-break>    $NewResource = New-Object Microsoft.ResourceManagement.Automation.ObjectModel.ImportObject<restore-line-break>    $NewResource.ObjectType = $ObjectType<restore-line-break>    $NewResource.SourceObjectIdentifier = [System.Guid]::NewGuid().ToString()<restore-line-break><restore-line-break>    AddChangeToResource $newResource <span class="str">"DisplayName"</span> $DisplayName <span class="str">"1"</span><restore-line-break><restore-line-break>    Return $NewResource<restore-line-break>}<restore-line-break><restore-line-break>#-- Loads <span class="kwrd">in</span> the handler <span class="kwrd">for</span> the GAC<restore-line-break>[System.Reflection.Assembly]::Load(<span class="str">"System.EnterpriseServices, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span>) | Out-Null<restore-line-break>$publish = New-Object System.EnterpriseServices.Internal.Publish<restore-line-break><restore-line-break><span class="kwrd">if</span> (-not (Test-Path $dllpath))<restore-line-break>{<restore-line-break>    <span class="kwrd">throw</span> <span class="kwrd">new</span>-<span class="kwrd">object</span> Exception <span class="str">"$dllpath does not exist"</span><restore-line-break>    exit<restore-line-break>}<restore-line-break><restore-line-break>$assembly = [System.Reflection.Assembly]::LoadFile( $dllpath )<restore-line-break>$publickey = $assembly.GetName().GetPublicKey()<restore-line-break>$aicstring = [System.Reflection.Assembly]::LoadFile( $dllpath ).FullName<restore-line-break><restore-line-break>$basename = $aicstring.Remove($aicstring.IndexOf(<span class="str">","</span>))<restore-line-break><restore-line-break>$wfpart = $<span class="kwrd">null</span><restore-line-break>$uipart = $<span class="kwrd">null</span><restore-line-break><restore-line-break>$types = $assembly.GetExportedTypes()<restore-line-break><restore-line-break><span class="kwrd">foreach</span> ($exportType <span class="kwrd">in</span> $types)<restore-line-break>{<restore-line-break>    <span class="kwrd">if</span> ($exportType.BaseType.Name -eq <span class="str">"ActivitySettingsPart"</span>)    { $uipart = <span class="str">"$exporttype"</span>}<restore-line-break>    <span class="kwrd">if</span> ($exportType.BaseType.Name -eq <span class="str">"SequenceActivity"</span>) { $wfpart = <span class="str">"$exporttype"</span>}<restore-line-break>}<restore-line-break><restore-line-break><span class="kwrd">if</span> ($publickey.length -eq 0)<restore-line-break>{<restore-line-break>    <span class="kwrd">throw</span> <span class="kwrd">new</span>-<span class="kwrd">object</span> exception <span class="str">"The Assembly $dllpath must be strongly signed"</span><restore-line-break>    exit<restore-line-break>}<restore-line-break><restore-line-break>$publish.GacInstall( $dllpath )<restore-line-break><restore-line-break>$aic = export-fimconfig -onlybaseresources -customconfig <span class="str">"/ActivityInformationConfiguration[DisplayName='$basename']"</span><restore-line-break><span class="kwrd">if</span> ($aic -eq $<span class="kwrd">null</span>)<restore-line-break>{<restore-line-break>    $new_aic = CreateResource <span class="str">"ActivityInformationConfiguration"</span> $basename<restore-line-break>    AddChangeToResource $new_aic <span class="str">"ActivityName"</span> $wfpart <span class="str">"0"</span><restore-line-break>    AddChangeToResource $new_aic <span class="str">"AssemblyName"</span> $aicstring <span class="str">"0"</span><restore-line-break>    AddChangeToResource $new_aic <span class="str">"TypeName"</span> $uipart <span class="str">"0"</span><restore-line-break>    AddChangeToResource $new_aic <span class="str">"IsActionActivity"</span> $<span class="kwrd">true</span> <span class="str">"0"</span><restore-line-break>    AddChangeToResource $new_aic <span class="str">"IsAuthorizationActivity"</span> $<span class="kwrd">true</span> <span class="str">"0"</span><restore-line-break>    AddChangeToResource $new_aic <span class="str">"IsConfigurationType"</span> $<span class="kwrd">false</span> <span class="str">"0"</span><restore-line-break>    AddChangeToResource $new_aic <span class="str">"IsAuthenticationActivity"</span> $<span class="kwrd">false</span> <span class="str">"0"</span><restore-line-break>    SubmitResource $new_aic<restore-line-break>}</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on January 9, 2022</p><div class="post__share"><h3>Share post:</h3></div><div class="post__bio"><div><h3><a href="https://github.com/identity-jason/identech/authors/identity_jason/" class="invert" rel="author">identity_jason</a></h3></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><nav id="menu"><header class="major"><h2>Menu</h2></header></nav><footer id="footer"><p class="copyright">&copy; Editorial 2 - All rights reserved<br>Design by: <a href="https://html5up.net" target="_blank" rel="noopener">HTML5 UP</a>, Powered by Publii</p></footer></div></div></div><script src="https://github.com/identity-jason/identech/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://github.com/identity-jason/identech/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://github.com/identity-jason/identech/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://github.com/identity-jason/identech/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://github.com/identity-jason/identech/assets/js/main.min.js?v=448f4c9d4b4c374766a1cb76c3d88048"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script></body></html>