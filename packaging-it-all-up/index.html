<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Packaging it all up - Identity Technology (again)</title><meta name="description" content="I’m currently in the middle of preparing a new XMA to hand over to a colleague, and as they need&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://github.com/identity-jason/identech/packaging-it-all-up/"><link rel="alternate" type="application/atom+xml" href="https://github.com/identity-jason/identech/feed.xml"><link rel="alternate" type="application/json" href="https://github.com/identity-jason/identech/feed.json"><meta property="og:title" content="Packaging it all up"><meta property="og:site_name" content="Identity Technology (again)"><meta property="og:description" content="I’m currently in the middle of preparing a new XMA to hand over to a colleague, and as they need&hellip;"><meta property="og:url" content="https://github.com/identity-jason/identech/packaging-it-all-up/"><meta property="og:type" content="article"><style>:root{--primary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--secondary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://github.com/identity-jason/identech/assets/css/style.css?v=dd2f5302461b6031e60971f8134aab44"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/identity-jason/identech/packaging-it-all-up/"},"headline":"Packaging it all up","datePublished":"2011-10-10T14:46","dateModified":"2022-01-09T11:32","description":"I’m currently in the middle of preparing a new XMA to hand over to a colleague, and as they need&hellip;","author":{"@type":"Person","name":"identity_jason"},"publisher":{"@type":"Organization","name":"identity_jason"}}</script></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://github.com/identity-jason/identech/"><strong>Identity Technology (again)</strong></a></header><article class="post"><header class="main post__header"><time datetime="2011-10-10T14:46" class="post__date">October 10, 2011</time><h1>Packaging it all up</h1></header><div class="post__inner post__entry"><p>I’m currently in the middle of preparing a new XMA to hand over to a colleague, and as they need to use it rather than code it, I thought I’d try to make things as easy for them as possible by using the Management Agent Packager that ships with MIIS/ILM/FIM to wrap it up into an installer for him.</p><p>Now while I’ve built the odd XMA or two, this is the first time I’ve actually come to use the MAPackager.exe, and I was a little surprised at just how little information was out there on web – in fact, I actually needed to look at the help files for once!</p><p>Fortunately, it’s relatively straight forward (easy to say in hindsight) and the process for using it is simple enough:</p><ol><li>Export the XMA that you’re planning to package (obviously – create it first!)</li><li>Create a “Customization File” that describes your XMA</li><li>Run the MAPackager tool</li><li>Distribute your newly packaged XMA</li></ol><p><strong><span style="font-size: medium;">1 - Export the XMA</span></strong></p><p>Hopefully this bits obvious – right click on the XMA and select the ‘Export Management Agent’ action (I suppose you could use the right hand action bar as well!)</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image1.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb1.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb1-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb1-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb1-md.png 768w" alt="image" width="648" height="214" border="0"></a></p><p>In this instance, I’m saving this out into my ‘standard’ FIMProject folder for ease of use.</p><p><strong><span style="font-size: medium;">2 – Create a “Customisation File” that describes your XMA</span></strong></p><p>This is a fairly simple XML document that describes your XMA – fortunately there’s a handy sample and table in the help files and it’s fairly quick to produce the file – my example looks like this:</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">ma-customization-info</span><span class="kwrd">&gt;</span><restore-line-break>     &lt;!—Integer value containing the version number –&gt;<restore-line-break>     <span class="kwrd">&lt;</span><span class="html">ma-internal-version</span><span class="kwrd">&gt;</span>1<span class="kwrd">&lt;/</span><span class="html">ma-internal-version</span><span class="kwrd">&gt; </span><restore-line-break>     &lt;!—‘Free Text’ (255 character strings) describing the XMA –&gt;<restore-line-break>     <span class="kwrd">&lt;</span><span class="html">ma-companyname</span><span class="kwrd">&gt;</span>Oxford Computer Group<span class="kwrd">&lt;/</span><span class="html">ma-companyname</span><span class="kwrd">&gt;</span><restore-line-break>     <span class="kwrd">&lt;</span><span class="html">ma-subtype</span><span class="kwrd">&gt;</span>Office365 Connectivity<span class="kwrd">&lt;/</span><span class="html">ma-subtype</span><span class="kwrd">&gt;</span><restore-line-break>     <span class="kwrd">&lt;</span><span class="html">ma-listname</span><span class="kwrd">&gt;</span>Office365<span class="kwrd">&lt;/</span><span class="html">ma-listname</span><span class="kwrd">&gt;</span><restore-line-break>     <span class="kwrd">&lt;</span><span class="html">ma-help-text</span><span class="kwrd">&gt;</span>Connecter for Microsoft Office365<span class="kwrd">&lt;/</span><span class="html">ma-help-text</span><span class="kwrd">&gt;</span><restore-line-break><span class="kwrd">&lt;/</span><span class="html">ma-customization-info</span><span class="kwrd">&gt;</span></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p><span style="font-size: medium;"><strong>3 – Run the MAPackager.exe tool</strong></span></p><p>The MAPackager tool is installed with the Synchronization Service – usually in the \program files\microsoft forefront identity manager\2010\synchronization service\bin folder.</p><p>The command line for mapackager.exe takes 3 command line parameters – the exported ma file, the customization file and the file to export the package out as:</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image2.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb2.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb2-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb2-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb2-md.png 768w" alt="image" width="630" height="314" border="0"></a></p><p>In my case, I have the following parameters for the xma export I’d already taken, and my customization file – I’m exporting my XML back into my FIMProject folder to keep things simple.</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image3.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb3.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb3-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb3-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb3-md.png 768w" alt="image" width="632" height="315" border="0"></a></p><p>Now that we’ve got the packaged xml file and the .dll file for the management agent itself, we can look at distributing the package.</p><p><strong><span style="font-size: medium;">4 - Distribute your newly packaged XMA</span></strong></p><p>In order to use your XMA, you need to get all the DLLs for it into the extensions folder and get the package xml into the PackagedMAs folder (\Synchronization Service\UIShell\XMLs\PackagedMAs) – once they’re there, your XMA will be added to the drop down list of available management agents.</p><p>To keep it simple, it’s worthwhile building a quick installer project to deliver our files into FIM – launch visual studio and create a new project – you’ll want to select a ‘Visual Studio Installer’ project – I’m calling this one “XMAInstaller”.</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image4.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb4.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb4-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb4-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb4-md.png 768w" alt="image" width="629" height="423" border="0"></a></p><p>Once the project is created, you’ll have the default installer screen:</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image5.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb5.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb5-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb5-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb5-md.png 768w" alt="image" width="461" height="149" border="0"></a></p><p>Select both “User’s Desktop” and “User’s Programs Menu” in turn, and delete them, before selecting the “Application Folder” item and open the Properties for it – we need to set the default folder as the root of the Synchronization Service installation.</p><p>Select the ‘DefaultLocation’ property and set it as follows:</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image6.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb6.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb6-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb6-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb6-md.png 768w" alt="image" width="631" height="250" border="0"></a></p><p>This gives us a working root folder of the Synchronization Service and from here we can “create” the necessary folders (these folders already exist, we’re just going to put in place the scaffold needed to direct the installer where we’re going to deploy our files to).</p><p>First, right click on the the ‘Application Folder’ Item and add a new Folder underneath it.</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image7.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb7.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb7-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb7-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb7-md.png 768w" alt="image" width="502" height="170" border="0"></a></p><p>Name the folder ‘Extensions’, and repeat this process to add another folder underneath the ‘Application Folder’ named UIShell. Continue to add folders, this time under the UIShell Folder create a new child Folder named ‘XMLs’, which in turn needs to have it’s own child folder named ‘PackagedMAs’.</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image8.png"><img loading="lazy" style="background-image: none; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb8.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb8-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb8-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb8-md.png 768w" alt="image" width="244" height="159" border="0"></a></p><p>Once that’s completed, drag your DLL files into the extensions folder, and the packaged xml (in this case, “o365_xma.xml”) into the PackagedMAs folder in the installer. Once that’s done, you should have a display along the lines of the following which shows the files referenced by the project (in the solution explorer) along with the contents to be installed into the selected folder – in this case, PackagedMAs.</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image9.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb9.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb9-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb9-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb9-md.png 768w" alt="image" width="623" height="208" border="0"></a></p><p>Build the solution, and this will give you an installer that you can distribute to make the deployment of your new XMA as simple as possible.</p><p><span style="font-size: medium;"><strong>5 - Using the XMA</strong></span></p><p>Once you’ve build the installation program, execute it to install the XMA and the package XML in order to drop the required files into the correct locations within FIM. Launch a new copy of the FIM console, and select the Management Agent Tab.</p><p>Click on the ‘Create new Management Agent’ Action, and in the drop down list of available Management Agents, you should see the newly installed XMA.</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image10.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb10.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb10-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb10-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb10-md.png 768w" alt="image" width="621" height="462" border="0"></a></p><p><strong><span style="font-size: medium;">Going Further</span></strong></p><p>To make things a little smoother and easier to manage, it’s going to be worthwhile embedding your installer projects into the main XMA solution – that way you get to keep all of the material relevant to the XMA in once place, and can implement your Customization Script and automation of the MAPackager.exe command – as well as linking directly to Project output:</p><p><a href="http://identitytechnology.net/wp-content/uploads/2011/10/image11.png"><img loading="lazy" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="https://github.com/identity-jason/identech/media/posts/18/image_thumb11.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb11-xs.png 300w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb11-sm.png 480w, https://github.com/identity-jason/identech/media/posts/18/responsive/image_thumb11-md.png 768w" alt="image" width="622" height="262" border="0"></a></p><p><strong>Things to watch out for!</strong></p><p>One thing that catches me out all the time, is that the install wizard is usually created configured for x86 deployment not x64 - which leaves me cursing and wondering where all my files have gone before discovering them under the "\program files (x86)\Microsoft Forefront Identity Manager" folder instead of where they need to be.</p></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on January 9, 2022</p><div class="post__share"><h3>Share post:</h3></div><div class="post__bio"><div><h3><a href="https://github.com/identity-jason/identech/authors/identity_jason/" class="invert" rel="author">identity_jason</a></h3></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><nav id="menu"><header class="major"><h2>Menu</h2></header></nav><footer id="footer"><p class="copyright">&copy; Editorial 2 - All rights reserved<br>Design by: <a href="https://html5up.net" target="_blank" rel="noopener">HTML5 UP</a>, Powered by Publii</p></footer></div></div></div><script src="https://github.com/identity-jason/identech/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://github.com/identity-jason/identech/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://github.com/identity-jason/identech/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://github.com/identity-jason/identech/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://github.com/identity-jason/identech/assets/js/main.min.js?v=448f4c9d4b4c374766a1cb76c3d88048"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script></body></html>